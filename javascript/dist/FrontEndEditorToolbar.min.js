/*
 *  Silverstripe front end admin  - v0.1
 *  Front end admin for Silverstripe
 *  
 *
 *  Made by Corey Sewell - Guru Digital Media
 *  Under BSD-3-Clause License
 */
!function(a){function b(a){var b,c=top.tinymce.activeEditor,d=c.selection,e=d.getContent();if(/</.test(e)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(e)||-1===e.indexOf("href=")))return!1;if(a){if(b=a.childNodes,0===b.length)return!1;for(i=b.length-1;i>=0;i--)if(3!==b[i].nodeType)return!1}return!0}var c=top.tinymce;c.activeEditor.cleanLink=function(a){return a},c.activeEditor.repaint=function(){},c.activeEditor.addUndo=function(){this.undoManager.add()},c.activeEditor.replaceContent=function(){this.undoManager.add()},c.activeEditor.replaceContent=function(a,b){this.execCommand("mceReplaceContent",!1,a,b)},a.entwine("ss",function(a){a("form.htmleditorfield-mediaform").entwine({onsubmit:function(b){b.preventDefault();var c=this.getEditor();this.find(".ss-htmleditorfield-file").each(function(){a(this).insertHTML(c)}),c.windowManager.close()}}),a("form.htmleditorfield-linkform").entwine({onsubmit:function(a){var b=this.getEditor();return a.preventDefault(),this.insertLink(),b.windowManager.close(),!1},insertLink:function(){var a=this.getEditor(),c=a.selection,d=a.dom,e=c.getNode(),f=d.getParent(e,"a[href]"),g=f?f.innerText||f.textContent:c.getContent({format:"text"}),h=this.getLinkAttributes(),i=b();f?(a.focus(),i&&("innerText"in f?f.innerText=g:f.textContent=g),d.setAttribs(f,h),c.select(f),a.undoManager.add()):i?a.insertContent(d.createHTML("a",h,d.encode(g))):a.execCommand("mceInsertLink",!1,h),this.updateFromEditor()}}),a("form.htmleditorfield-form button").entwine({onadd:function(){this.button().addClass("ss-ui-button")}}),a("form.htmleditorfield-form").entwine({onadd:function(){var a=this.getEditor(),b=a.selection;this.setSelection(b.getNode()),this.find(":input:not(:submit)[data-skip-autofocus!=true]").filter(":visible:enabled").eq(0).focus(),this.updateFromEditor(),this.redraw(),this._super()},getEditor:function(){return top.tinymce.activeEditor}})})}(jQuery);