/*
 *  Silverstripe front end admin  - v0.0.1
 *  Front end admin for Silverstripe
 *  https://github.com/gurudigital/frontend-admin
 *
 *  Made by Corey Sewell - Guru Digital Media
 *  Under BSD-3-Clause License
 *
 */

!function(a){function b(a){var b,c=top.tinymce.activeEditor,d=c.selection,e=d.getContent();if(/</.test(e)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(e)||-1===e.indexOf("href=")))return!1;if(a){if(b=a.childNodes,i,0===b.length)return!1;for(i=b.length-1;i>=0;i--)if(3!==b[i].nodeType)return!1}return!0}ss.editorWrappers.tinyMCE4=function(){return{init:function(){ss.editorWrappers.tinyMCE4.initialized=!0},getInstance:function(){return this.instance},setInstance:function(a){this.instance=a},onopen:function(){},onclose:function(){},save:function(){tinyMCE.triggerSave()},create:function(b,c){a("#"+b).tinymce(c),this.instance=top.tinymce.activeEditor},repaint:function(){},isDirty:function(){return this.getInstance().isDirty()},getContent:function(){return this.getInstance().getContent()},getDOM:function(){return this.getInstance().dom},getContainer:function(){return this.getInstance().getContainer()},getSelectedNode:function(){return this.getInstance().selection.getNode()},selectNode:function(a){this.getInstance().selection.select(a)},setContent:function(a,b){this.getInstance().execCommand("mceSetContent",!1,a,b)},insertContent:function(a,b){this.getInstance().execCommand("mceInsertContent",!1,a,b)},replaceContent:function(a,b){this.getInstance().execCommand("mceReplaceContent",!1,a,b)},insertLink:function(a){var c=this.getInstance(),d=c.selection,e=c.dom,f=d.getNode(),g=e.getParent(f,"a[href]"),h=g?g.innerText||g.textContent:d.getContent({format:"text"}),i=b();g?(c.focus(),i&&("innerText"in g?g.innerText=h:g.textContent=h),e.setAttribs(g,a),d.select(g),c.undoManager.add()):i?c.insertContent(e.createHTML("a",a,e.encode(h))):c.execCommand("mceInsertLink",!1,a)},removeLink:function(){this.getInstance().execCommand("unlink",!1)},cleanLink:function(a,b){return this.getInstance().settings.urlconverter_callback?this.getInstance().execCallback("urlconverter_callback",a,b,!0):(a.match(new RegExp("^"+this.getInstance().settings.document_base_url+"(.*)$"))&&(a=RegExp.$1),a)},createBookmark:function(){return this.getInstance().selection.getBookmark()},moveToBookmark:function(a){this.getInstance().selection.moveToBookmark(a),this.getInstance().focus()},blur:function(){this.getInstance().selection.collapse()},addUndo:function(){this.getInstance().undoManager.add()},closeDialog:function(){this.getInstance().windowManager.close()}}},ss.editorWrappers["default"]=ss.editorWrappers.tinyMCE4;var c=new ss.editorWrappers["default"];c.setInstance(top.tinymce.activeEditor),a.entwine("ss",function(a){a("form.htmleditorfield-form").entwine({close:function(){this.getDialog().close()},getEditor:function(){return c}}),a("form.htmleditorfield-form button").entwine({onadd:function(){this.button().addClass("ss-ui-button")}}),a("form.htmleditorfield-linkform button[name=action_remove]").entwine({onclick:function(a){a.preventDefault(),this.parents("form:first").removeLink()}}),a(".htmleditorfield-dialog").entwine({onadd:function(){this.trigger("ssdialogopen"),this._super()},getEditor:function(){return c},close:function(){this.getEditor().closeDialog()}})})}(jQuery);