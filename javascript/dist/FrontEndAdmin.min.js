/*
 *  gdmedia/silverstripe-frontend-admin - v
 *  Front end admin for Silverstripe
 *  https://github.com/gurudigital/frontend-admin
 *
 *  Made by Corey Sewell - Guru Digital Media
 *  Under BSD-3-Clause License
 */
!function(a){var b={editmode:!1,highlight:!1,width:"false",height:"false",y:"false",load:function(){var c=document.cookie.split(";");a.each(this,function(d,e){var f,g,h;if(!a.isFunction(e))for(f=d+"=",g=0;g<c.length;g++){for(h=c[g];" "===h.charAt(0);)h=h.substring(1,h.length);0===h.indexOf(f)&&(b[d]=h.substring(f.length,h.length))}})},save:function(){var b=new Date;b.setTime(b.getTime()+12096e5),a.each(this,function(c,d){a.isFunction(d)||(document.cookie=c+"="+d+"; expires="+b.toGMTString()+"; path=/")})}};b.load(),a(function(){var c=a("meta[name='x-cms-edit-link']").attr("content");"undefined"!=typeof window.jQuery.fn.button&&"function"==typeof window.jQuery.fn.button.noConflict&&(window.jQuery.fn.bootstrapBtn=window.jQuery.fn.button.noConflict()),a.entwine("ss.frontEndAdmin",function(a){a("div.admin-panel").entwine({OpenPosition:0,ClosedPosition:0,AdminBtn:a("<button>").addClass("btn btn-default").attr("id","adminToggle").text(frontEndAdmin.toggleLabel),AdminBtnWrap:a("<div>").addClass("admin-panel-toggle-wrap"),AdminFrame:a("<iframe>").attr("id","admin-frame").attr("src",frontEndAdmin.editHref+(frontEndAdmin.editHref.split("?")[1]?"&":"?")+"frontEndAdmin=true"),AdminFrameWrap:a("<div>").addClass("admin-frame-wrap"),ToolsWrap:a("<div>").addClass("admin-tools-wrap ui-widget-header ui-corner-all"),ToolsEditMode:a("<input type='checkbox' />").data("settings-key","editmode").attr("id","admin-tools-editmode").addClass("admin-tools-editmode admin-tools-toggle saveable"),ToolsEditModeLabel:a("<label>"+frontEndAdmin.editModeLabel+"</label>").addClass("btn btn-default"),ToolsHighlight:a("<input type='checkbox'/>").data("settings-key","highlight").attr("id","admin-tools-highlight").addClass("admin-tools-highlight admin-tools-toggle saveable"),ToolsHighlightLabel:a("<label>"+frontEndAdmin.highlightLabel+"</label>").addClass("btn btn-default"),ToolsCMSLink:a("<a>"+frontEndAdmin.cmsLabelLink+"</a>").attr("href",c).attr("target","_blank").addClass("admin-tools-cmslink admin-tools-link btn btn-default"),onmatch:function(){if(!a("body").hasClass("cms-dialog")){var c=this;c.append(c.getToolsWrap().append(c.getToolsEditModeLabel().attr("for",c.getToolsEditMode().attr("id"))).append(c.getToolsEditMode()).append(c.getToolsHighlightLabel().attr("for",c.getToolsHighlight().attr("id"))).append(c.getToolsHighlight()).append(c.getToolsCMSLink())),c.append(c.getAdminFrameWrap().append(c.getAdminFrame())).append(c.getAdminBtnWrap().append(c.getAdminBtn())),isNaN(b.y)||c.css({top:b.y+"px"}),isNaN(b.width)||c.getAdminFrameWrap().width(b.width),isNaN(b.height)||c.getAdminFrameWrap().height(b.height),c.calculatePositions().hide().removeClass("admin-menu-hide").css({left:c.getClosedPosition()}).fadeIn(function(){c.draggable({handle:c.getAdminBtnWrap().parent(),axis:"y",stop:function(){b.y=a(this).position().top,b.save()}}),c.getAdminFrameWrap().resizable({stop:function(){a("div.admin-panel").calculatePositions(),b.width=a(this).width(),b.height=a(this).height(),b.save()}})})}},toggleAdmin:function(b,c){var d=400,e=this,f=parseInt(e.position().left,10),g=f>=e.getOpenPosition()?e.getClosedPosition():e.getOpenPosition();"undefined"!=typeof b&&(g=b?e.getOpenPosition():e.getClosedPosition()),b=g===e.getOpenPosition(),setTimeout(function(){e.getAdminBtn().setIcon(b?frontEndAdmin.toggleIconOpen:frontEndAdmin.toggleIconClosed)},d/2),e.animate({left:g},d,"easeInBack",function(){a.isFunction(c)&&c.apply(e,b)})},calculatePositions:function(){return this.setOpenPosition(-(parseInt(this.css("padding-left"),10)+parseInt(this.css("margin-left"),10)-parseInt(this.css("padding-right"),10)/2)),this.setClosedPosition(-(this.outerWidth()+parseInt(this.css("margin-left"),10))),this}}),a("#adminToggle").entwine({onmatch:function(){this.button({icons:{secondary:frontEndAdmin.toggleIconClosed}})},onclick:function(){a("div.admin-panel").toggleAdmin()},setIcon:function(a){this.button({icons:{secondary:a}})}}),a(".admin-tools-editmode").entwine({onmatch:function(){this.button({icons:{primary:"ui-icon-pencil",secondary:"ui-icon-circle-close"}}),this._super()},onchange:function(){this._super(),a(".admin-tools-highlight").button("option","disabled",!this.prop("checked"))},onclick:function(){window.location.reload()}}),a(".admin-tools-highlight").entwine({onmatch:function(){this.button({icons:{primary:"ui-icon-circlesmall-minus",secondary:"ui-icon-circle-close"}}),this._super()},onchange:function(){this.prop("checked")?a("body").addClass("highlight-editable"):a("body").removeClass("highlight-editable"),this._super()}}),a(".admin-tools-toggle").entwine({onchange:function(){var a=this.button("option","icons");a.secondary=this.prop("checked")?"ui-icon-circle-check":"ui-icon-circle-close",this.button({icons:a}),this._super()}}),a(".admin-tools-cmslink").entwine({onmatch:function(){this.button({icons:{primary:"ui-icon-newwin"}})}}),a(".saveable").entwine({onmatch:function(){this._super();var a,c=this.data("settings-key");"undefined"!=typeof b[c]&&(a=b[c],this.is(":checkbox")?this.prop("checked",a&&"false"!==a):this.val(a),this.change())},onchange:function(){var a,c=this.data("settings-key");"undefined"!=typeof b[c]&&(a=b[c],b[c]=this.is(":checkbox")?this.prop("checked"):this.val(),b.save()),this._super()}}),a("#admin-frame").entwine({onmatch:function(){this.load(function(){var b=a(this)[0].contentWindow,c=b.jQuery;c("#preview-mode-dropdown-in-content").entwine({onmatch:function(){this.remove()}}),c(".logout-link").attr("target","_top"),c("div.cms-container").entwine({onbeforestatechange:function(a,b){b.state.url=b.state.url+(b.state.url.split("?")[1]?"&":"?")+"frontEndAdmin=true"}})})}}),a("<div>").addClass("admin-panel admin-menu-hide").appendTo(a("body"))})})}(jQuery);