/*
 *  Silverstripe front end admin  - v0.0.1
 *  Front end admin for Silverstripe
 *  https://github.com/gurudigital/frontend-admin
 *
 *  Made by Corey Sewell - Guru Digital Media
 *  Under BSD-3-Clause License
 *
 */

!function(a){tinymce.PluginManager.add("SSFEButtons",function(b){function c(){e()?b.windowManager.open({title:"Insert link",url:frontEndAdmin.linkURL,autoScroll:!0,width:700,height:500,classes:"frontend-editable-dialog"}):b.windowManager.alert("Please make a selection to insert a link")}function d(){b.windowManager.open({title:"Insert/edit image",url:frontEndAdmin.mediaURL,autoScroll:!0,width:700,height:500,classes:"frontend-editable-dialog"})}function e(){return!b.selection.isCollapsed()||"A"===b.selection.getNode().nodeName}function f(){var a=this;a.disabled(!e()),b.on("SelectionChange",function(){a.disabled(!e())})}b.addShortcut("Ctrl+K","",c),b.addCommand("ssfelink",c),b.addButton("ssfeLink",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",stateSelector:"a[href]",onclick:c,onPostRender:f}),b.addMenuItem("ssfeLink",{icon:"link",text:"Insert link",shortcut:"Ctrl+K",onclick:c,stateSelector:"a[href]",context:"insert",prependToContext:!0,onPostRender:f}),b.addButton("ssfeimage",{icon:"image",tooltip:"Insert/edit image",onclick:d,stateSelector:"img:not([data-mce-object],[data-mce-placeholder])"}),b.addMenuItem("ssfeimage",{icon:"image",text:"Insert image",onclick:d,context:"insert",prependToContext:!0});var g=/(.?)\[embed(.*?)\](.+?)\[\/\s*embed\s*\](.?)/gi;b.on("BeforeSetContent",function(b){for(var c,d,e,f,h,i,j,k,l,m,n=null,o=b.content;n=g.exec(o);)if(c=n[1],d=n[4],"["!==c||"]"!==d){e={},f=n[2].replace(/['"]/g,"").replace(/(^\s+|\s+$)/g,""),i=f.split(/\s+/);for(k in i)i.hasOwnProperty(k)&&(j=i[k].split("="),1===j.length?e[j[0]]=j[0]:e[j[0]]=j[1]);e.cssclass=e["class"],h=n[3],l=a("<img/>").attr({src:e.thumbnail,width:e.width,height:e.height,"class":e.cssclass,"data-url":h}).addClass("ss-htmleditorfield-file embed");for(m in e)l.attr("data-"+m,e[m]);o=o.replace(n[0],c+a("<div/>").append(l).html()+d)}b.content=o})})}(jQuery);