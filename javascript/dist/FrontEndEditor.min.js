/*
 *  gdmedia/silverstripe-frontend-admin - v
 *  Front end admin for Silverstripe
 *  https://github.com/gurudigital/frontend-admin
 *
 *  Made by Corey Sewell - Guru Digital Media
 *  Under BSD-3-Clause License
 */
var frontEndAdmin=frontEndAdmin||{};!function(a){function b(b){var c="",e=a(b.getElement()),f={fefield:e.data("fefield"),feid:e.data("feid"),feclass:e.data("feclass"),value:b.getContent()};e.data("originalContent",b.getContent()),e.hasClass("frontend-editable-html")&&(c=a(f.value),c.find(".ss-htmleditorfield-file.embed").each(function(){var b=a(this),c="[embed width='"+b.attr("width")+"' height='"+b.attr("height")+"' class='"+b.data("cssclass")+"' thumbnail='"+b.data("thumbnail")+"']"+b.data("url")+"[/embed]";b.replaceWith(c)}),c.length&&(f.value=a("<div />").append(c).html())),b.getBody().setAttribute("contenteditable","false"),d(f,e,function(){b.getBody().setAttribute("contenteditable","true")})}function c(a){var b={fefield:a.data("fefield"),feid:a.data("feid"),feclass:a.data("feclass"),value:a.val()};a.prop("disabled",!0),d(b,a,function(){a.prop("disabled",!1)})}function d(b,c,d){var e,f,g=a.Event("FrontEndEditor:onBeforeSave");a(document).trigger(g,[b,c]),g.isDefaultPrevented()||(e=SS_StatusMessage.loading("Saving "+b.fefield,"Saving",{sticky:!0}),f=a.Callbacks(),a.isFunction(d)&&f.add(d),f.add(function(a){SS_StatusMessage.create(a.content,SS_StatusMessageTypes.fromForm(a.type),a.title,a.options)}),a.post(frontEndAdmin.baseHref+"home/fesave",b).done(function(b){var d=a.Event("FrontEndEditor:onAfterSave");a(document).trigger(d,[b,c]),d.isDefaultPrevented()||f.fire(b,c)}).fail(function(a){SS_StatusMessage.danger("Unexpected error occurred<br/>"+a.responseText,"error")}).always(function(){e.hide()}))}if(frontEndAdmin.baseHref=a("base").attr("href"),-1!==a("title").text().search("<")){var e=a(a("title").text());a("title").html(e.text())}frontEndAdmin.tinymceGlobalDefaults={inline:!0,save_enablewhendirty:!1,save_onsavecallback:b,script_url:frontEndAdmin.baseHref+"silverstripe-frontend-admin/bower_components/tinymce/tinymce.min.js",external_plugins:{SSFEButtons:frontEndAdmin.baseHref+"silverstripe-frontend-admin/javascript/dist/tinymce_ssfebuttons.min.js"}},frontEndAdmin.tinymceDefaults=a.extend({},frontEndAdmin.tinymceGlobalDefaults,{plugins:["save advlist autolink lists image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor  nonbreaking SSFEButtons"],toolbar1:"save undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | ssfeLink ssfeimage",toolbar2:"print preview media | forecolor backcolor emoticons",contextmenu:"ssfeLink ssfeimage inserttable | cell row column deletetable",image_advtab:!0,remove_script_host:!0,convert_urls:!0,relative_urls:!0,document_base_url:frontEndAdmin.baseHref,extended_valid_elements:"-p[style|class]"}),frontEndAdmin.tinymceVarCharDefaults=a.extend({},frontEndAdmin.tinymceGlobalDefaults,{plugins:["save "],toolbar1:"save cancel undo redo ",menubar:!1,statusbar:!1,toolbar_items_size:"small"}),a("a .frontend-editable").click(function(a){a.preventDefault()}),a(".frontend-editable-varchar, .frontend-editable-html").entwine({onmatch:function(){var b,c,d=a.Event("FrontEndEditor:onBeforeInitEditor"),e=a("<span class='fe-label' style='position: absolute'><span class='fe-label-text'></span></span>"),f=this.offset();e.css({top:f.top-e.outerHeight(),left:f.left}).find(".fe-label-text").text(this.data("feclass")+" (ID: "+this.data("feid")+") - "+this.data("fefield")),this.data("fe-label",e),this.positionLabel(),a("body").append(e),a(document).trigger(d,[this,b]),this.hasClass("frontend-editable-varchar")?(b=a.extend({},frontEndAdmin.tinymceVarCharDefaults),c=a.Event("FrontEndEditor:onAfterInitVarChar")):this.hasClass("frontend-editable-html")&&(b=a.extend({},frontEndAdmin.tinymceDefaults),c=a.Event("FrontEndEditor:onAfterInitHTML")),d.isDefaultPrevented()||((this.hasClass("frontend-editable-varchar")||this.hasClass("frontend-editable-html"))&&this.tinymce(b),a(document).trigger(c,[this]))},onmouseenter:function(){this.showLabel()},onmouseleave:function(){this.hideLabel()},onfocusin:function(){this.showLabel()},onfocusout:function(){this.hideLabel()},showLabel:function(){var a=this.data("fe-label");a&&(this.positionLabel(),a.addClass("fe-label-show"))},hideLabel:function(){var a=this.data("fe-label");a&&!this.is(":focus")&&a.removeClass("fe-label-show")},positionLabel:function(){var a=this.data("fe-label"),b=this.offset(),c=parseInt(a.css("padding-left"),10),d=b.top,e=b.left;a&&(d-=a.outerHeight(),c&&(e-=c),a.css({top:d,left:e}))}}),a(".frontend-editable-enum, .frontend-editable-boolean").entwine({SaveEnabled:!0,onmatch:function(){var b=a.Event("FrontEndEditor:onBeforeInitEditor");a(document).trigger(b,[this,options]),this.setSaveEnabled(!b.isDefaultPrevented())},onchange:function(){this.getSaveEnabled()&&c(this)}})}(jQuery);