/*
 *  Silverstripe front end admin  - v0.1
 *  Front end admin for Silverstripe
 *  
 *
 *  Made by Corey Sewell - Guru Digital Media
 *  Under BSD-3-Clause License
 */
var frontEndAdmin=frontEndAdmin||{};!function(a){function b(b){var c="",e=a(b.getElement()),f={fefield:e.data("fefield"),feid:e.data("feid"),feclass:e.data("feclass"),value:b.getContent()};e.data("originalContent",b.getContent()),c=a(f.value),c.find(".ss-htmleditorfield-file.embed").each(function(){var b=a(this),c="[embed width='"+b.attr("width")+"' height='"+b.attr("height")+"' class='"+b.data("cssclass")+"' thumbnail='"+b.data("thumbnail")+"']"+b.data("url")+"[/embed]";b.replaceWith(c)}),c.length&&(f.value=a("<div />").append(c).html()),b.getBody().setAttribute("contenteditable","false"),d(f,e,function(){b.getBody().setAttribute("contenteditable","true")})}function c(a){var b={fefield:a.data("fefield"),feid:a.data("feid"),feclass:a.data("feclass"),value:a.val()};a.prop("disabled",!0),d(b,a,function(){a.prop("disabled",!1)})}function d(b,c,d){var f,g,h=a.Event("FrontEndEditor:onBeforeSave");a(document).trigger(h,[b,c]),h.isDefaultPrevented()||(f=e({content:"Saving "+b.fefield,type:"loading"}),e(b),g=a.Callbacks(),a.isFunction(d)&&g.add(d),g.add(function(a){e(a)}),a.post(frontEndAdmin.baseHref+"home/fesave",b).done(function(b){var d=a.Event("FrontEndEditor:onAfterSave");a(document).trigger(d,[b,c]),d.isDefaultPrevented()||g.fire(b,c)}).fail(function(){e({content:"Unexpected error occurred",type:"bad"})}).always(function(){f.hide()}))}function e(a){var b;if("string"==typeof a&&(a={content:a}),"string"==typeof a.content){switch("string"!=typeof a.type&&(a.type="info"),a.type){case"good":case"success":b=toastr.success(a.content,a.title,a.options);break;case"bad":case"error":b=toastr.error(a.content,a.title,a.options);break;case"warning":case"warn":b=toastr.warning(a.content,a.title,a.options);break;case"loading":a.options={extendedTimeOut:0,timeOut:0,iconClass:"toast-info toast-icon-loading"},b=toastr.warning(a.content,a.title,a.options);break;default:b=toastr.info(a.content,a.title,a.options)}return b}}if(frontEndAdmin.baseHref=a("base").attr("href"),a(function(){"undefined"==typeof toastr&&a.getScript(frontEndAdmin.baseHref+"silverstripe-frontend-admin/javascript/thirdparty/toastr.min.js")}),-1!==a("title").text().search("<")){var f=a(a("title").text());a("title").html(f.text())}frontEndAdmin.tinymceGlobalDefaults={inline:!0,save_enablewhendirty:!1,save_onsavecallback:b,script_url:frontEndAdmin.baseHref+"silverstripe-frontend-admin/javascript/thirdparty/tinymce/js/tinymce/tinymce.min.js"},frontEndAdmin.tinymceDefaults=a.extend({},frontEndAdmin.tinymceGlobalDefaults,{plugins:["save advlist autolink lists image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor  nonbreaking SSFEButtons"],toolbar1:"save undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | ssfeLink ssfeimage",toolbar2:"print preview media | forecolor backcolor emoticons",contextmenu:"ssfeLink ssfeimage inserttable | cell row column deletetable",image_advtab:!0,remove_script_host:!0,convert_urls:!0,relative_urls:!0,document_base_url:frontEndAdmin.baseHref,extended_valid_elements:"-p[style|class]"}),frontEndAdmin.tinymceVarCharDefaults=a.extend({},frontEndAdmin.tinymceGlobalDefaults,{plugins:["save "],toolbar1:"save cancel undo redo ",menubar:!1,statusbar:!1,toolbar_items_size:"small"}),a(".frontend-editable-varchar").entwine({onmatch:function(){var b=a.Event("FrontEndEditor:onBeforeInitEditor"),c=a.extend({},frontEndAdmin.tinymceVarCharDefaults),d=a.Event("FrontEndEditor:onAfterInitVarChar");a(document).trigger(b,[this,c]),b.isDefaultPrevented()||(this.tinymce(c),a(document).trigger(d,[this]))}}),a(".frontend-editable-html").entwine({onmatch:function(){var b=a.Event("FrontEndEditor:onBeforeInitEditor"),c=a.extend({},frontEndAdmin.tinymceDefaults),d=a.Event("FrontEndEditor:onAfterInitHTML");a(document).trigger(b,[this,c]),b.isDefaultPrevented()||(this.tinymce(c),a(document).trigger(d,[this]))}}),a(".frontend-editable-enum").entwine({SaveEnabled:!0,onmatch:function(){var b=a.Event("FrontEndEditor:onBeforeInitEditor");a(document).trigger(b,[this,options]),this.setSaveEnabled(!b.isDefaultPrevented())},onchange:function(){this.getSaveEnabled()&&c(this)}}),a(".frontend-editable-boolean").entwine({SaveEnabled:!0,onmatch:function(){var b=a.Event("FrontEndEditor:onBeforeInitEditor");a(document).trigger(b,[this,options]),this.setSaveEnabled(!b.isDefaultPrevented())},onchange:function(){this.getSaveEnabled()&&c(this)}})}(jQuery);